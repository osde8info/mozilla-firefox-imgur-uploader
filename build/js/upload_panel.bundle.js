!function(e){var r={};function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=r,o.d=function(e,r,t){o.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,r){if(1&r&&(e=o(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(o.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var n in e)o.d(t,n,function(r){return e[r]}.bind(null,n));return t},o.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(r,"a",r),r},o.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},o.p="",o(o.s=5)}([function(e,r){e.exports=class{constructor(){browser.storage.local.get("firefox-uploader-imgur").then(e=>{0==Object.getOwnPropertyNames(e).length&&(console.log("test"),browser.storage.local.set({"firefox-uploader-imgur":[]}))})}add(e){return new Promise((r,o)=>{browser.storage.local.get("firefox-uploader-imgur").then(o=>{var t=o["firefox-uploader-imgur"];e.viewable=!0,t.push(e),console.log(t),browser.storage.local.set({"firefox-uploader-imgur":t}).then(()=>{r("test")})})})}remove(e){browser.storage.local.get("firefox-uploader-imgur").then(r=>{var o=[];for(let t of r["firefox-uploader-imgur"])t.id!=e&&o.push(t);browser.storage.local.set({"firefox-uploader-imgur":o})})}change(e,r){!e instanceof Array&&(e=[e]);browser.storage.local.get("firefox-uploader-imgur").then(o=>{var t=[];for(let a of o["firefox-uploader-imgur"])if(e.indexOf(a.id)>=0){for(var n in console.log(e),console.log(r),r)r.hasOwnProperty(n)&&(a[n]=r[n]);console.log(a),t.push(a)}else t.push(a);browser.storage.local.set({"firefox-uploader-imgur":t})})}removeAll(){browser.storage.local.set({"firefox-uploader-imgur":[]})}}},function(e,r,o){var t=o(2);e.exports=class{constructor(){browser.storage.local.get("firefox-uploader-client-id").then(e=>{var r=["a6bebdd6a51f656","f752792c52f4cdf","474d8a50e7e752d","9089d7837e30269","6c6fa522da181b8","bbf63f907ae5614","480391db79e87b6","ea76f402e22007a"];void 0!==e["firefox-uploader-client-id"]?(this.clientID=e["firefox-uploader-client-id"],console.log(e["firefox-uploader-client-id"])):this.clientID=r[Math.floor(Math.random()*r.length)],console.log(this.clientID)})}update(){browser.storage.local.get("firefox-uploader-client-id").then(e=>{var r=["a6bebdd6a51f656","f752792c52f4cdf","474d8a50e7e752d","9089d7837e30269","6c6fa522da181b8","bbf63f907ae5614","480391db79e87b6","ea76f402e22007a"];void 0!==e["firefox-uploader-client-id"]?(this.clientID=e["firefox-uploader-client-id"],console.log(e["firefox-uploader-client-id"])):this.clientID=r[Math.floor(Math.random()*r.length)],console.log(this.clientID)})}uuid(){var e=Date.now();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(r){var o=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===r?o:3&o|8).toString(16)}))}imageReader(e){let r=new FileReader;return new Promise((o,t)=>{r.onload=e=>{o(e.target.result.split("base64,")[1])},r.onerror=()=>t(this),r.readAsDataURL(e)})}uploadToImgur(e){var r=this;return new Promise((o,n)=>{console.log(this),console.log(r.uuid());var a={url:"https://api.imgur.com/3/image",headers:{authorization:"Client-ID "+r.clientID},json:{image:e}};console.log(a),t.post(a,(function(e,r,t){console.log(t.data),t.data.error?n(t.data):o(t.data)}))})}uploader(e){return this.imageReader(e).then(this.uploadToImgur.bind(this))}remove(e){var r=this;return new Promise((o,n)=>{var a={method:"delete",url:"https://api.imgur.com/3/image/"+e,headers:{authorization:"Client-ID "+r.clientID}};console.log(a),t(a,(function(e,r,t){var a=JSON.parse(t);a.data?o(a):n(a)}))})}}},function(e,r,o){var t,n,a;n=[],void 0===(a="function"==typeof(t=function(){var e=XMLHttpRequest;if(!e)throw new Error("missing XMLHttpRequest");function r(a,i){if("function"!=typeof i)throw new Error("Bad callback given: "+i);if(!a)throw new Error("No options given");var s=a.onResponse;if((a="string"==typeof a?{uri:a}:JSON.parse(JSON.stringify(a))).onResponse=s,a.verbose&&(r.log=function(){var e,r,o={},a=["trace","debug","info","warn","error"];for(r=0;r<a.length;r++)o[e=a[r]]=t,"undefined"!=typeof console&&console&&console[e]&&(o[e]=n(console,e));return o}()),a.url&&(a.uri=a.url,delete a.url),!a.uri&&""!==a.uri)throw new Error("options.uri is a required argument");if("string"!=typeof a.uri)throw new Error("options.uri must be a string");for(var d=["proxy","_redirectsFollowed","maxRedirects","followRedirect"],u=0;u<d.length;u++)if(a[d[u]])throw new Error("options."+d[u]+" is not supported");if(a.callback=i,a.method=a.method||"GET",a.headers=a.headers||{},a.body=a.body||null,a.timeout=a.timeout||r.DEFAULT_TIMEOUT,a.headers.host)throw new Error("Options.headers.host is not supported");a.json&&(a.headers.accept=a.headers.accept||"application/json","GET"!==a.method&&(a.headers["content-type"]="application/json"),"boolean"!=typeof a.json?a.body=JSON.stringify(a.json):"string"!=typeof a.body&&(a.body=JSON.stringify(a.body)));var l=function(e){var r=[];for(var o in e)e.hasOwnProperty(o)&&r.push(encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return r.join("&")};if(a.qs){var c="string"==typeof a.qs?a.qs:l(a.qs);-1!==a.uri.indexOf("?")?a.uri=a.uri+"&"+c:a.uri=a.uri+"?"+c}if(a.form){if("string"==typeof a.form)throw"form name unsupported";if("POST"===a.method){var f=(a.encoding||"application/x-www-form-urlencoded").toLowerCase();switch(a.headers["content-type"]=f,f){case"application/x-www-form-urlencoded":a.body=l(a.form).replace(/%20/g,"+");break;case"multipart/form-data":var p=function(e){var r={};r.boundry="-------------------------------"+Math.floor(1e9*Math.random());var o=[];for(var t in e)e.hasOwnProperty(t)&&o.push("--"+r.boundry+'\nContent-Disposition: form-data; name="'+t+'"\n\n'+e[t]+"\n");return o.push("--"+r.boundry+"--"),r.body=o.join(""),r.length=r.body.length,r.type="multipart/form-data; boundary="+r.boundry,r}(a.form);a.body=p.body,a.headers["content-type"]=p.type;break;default:throw new Error("unsupported encoding:"+f)}}}return a.onResponse=a.onResponse||t,!0===a.onResponse&&(a.onResponse=i,a.callback=t),!a.headers.authorization&&a.auth&&(a.headers.authorization="Basic "+function(e){var r,o,t,n,a,i,s,d,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l=0,c=0,f="",p=[];if(!e)return e;do{r=e.charCodeAt(l++),o=e.charCodeAt(l++),t=e.charCodeAt(l++),n=(d=r<<16|o<<8|t)>>18&63,a=d>>12&63,i=d>>6&63,s=63&d,p[c++]=u.charAt(n)+u.charAt(a)+u.charAt(i)+u.charAt(s)}while(l<e.length);switch(f=p.join(""),e.length%3){case 1:f=f.slice(0,-2)+"==";break;case 2:f=f.slice(0,-1)+"="}return f}(a.auth.username+":"+a.auth.password)),function(t){var n=new e,a=!1,i=function(e){var r,o=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/;try{r=location.href}catch(e){(r=document.createElement("a")).href="",r=r.href}var t=o.exec(r.toLowerCase())||[],n=o.exec(e.toLowerCase());return!(!n||n[1]==t[1]&&n[2]==t[2]&&(n[3]||("http:"===n[1]?80:443))==(t[3]||("http:"===t[1]?80:443)))}(t.uri),s="withCredentials"in n;if(o+=1,n.seq_id=o,n.id=o+": "+t.method+" "+t.uri,n._id=n.id,i&&!s){var d=new Error("Browser does not support cross-origin request: "+t.uri);return d.cors="unsupported",t.callback(d,n)}n.timeoutTimer=setTimeout((function(){a=!0;var e=new Error("ETIMEDOUT");return e.code="ETIMEDOUT",e.duration=t.timeout,r.log.error("Timeout",{id:n._id,milliseconds:t.timeout}),t.callback(e,n)}),t.timeout);var u={response:!1,loading:!1,end:!1};return n.onreadystatechange=function(o){if(a)return r.log.debug("Ignoring timed out state change",{state:n.readyState,id:n.id});if(r.log.debug("State change",{state:n.readyState,id:n.id,timed_out:a}),n.readyState===e.OPENED)for(var i in r.log.debug("Request started",{id:n.id}),t.headers)n.setRequestHeader(i,t.headers[i]);else n.readyState===e.HEADERS_RECEIVED?l():n.readyState===e.LOADING?(l(),c()):n.readyState===e.DONE&&(l(),c(),function(){if(u.end)return;if(u.end=!0,r.log.debug("Request done",{id:n.id}),n.body=n.responseText,t.json)try{n.body=JSON.parse(n.responseText)}catch(e){return t.callback(e,n)}t.callback(null,n,n.body)}())},n.open(t.method,t.uri,!0),i&&(n.withCredentials=!!t.withCredentials),n.send(t.body),n;function l(){if(!u.response){if(u.response=!0,r.log.debug("Got response",{id:n.id,status:n.status}),clearTimeout(n.timeoutTimer),n.statusCode=n.status,i&&0==n.statusCode){var e=new Error("CORS request rejected: "+t.uri);return e.cors="rejected",u.loading=!0,u.end=!0,t.callback(e,n)}t.onResponse(null,n)}}function c(){u.loading||(u.loading=!0,r.log.debug("Response body loading",{id:n.id}))}}(a)}r.log={trace:t,debug:t,info:t,warn:t,error:t};var o=0;function t(){}function n(e,r){return function(o,t){return"object"==typeof t&&(o+=" "+JSON.stringify(t)),e[r].call(e,o)}}return r.withCredentials=!1,r.DEFAULT_TIMEOUT=18e4,r.defaults=function(e,o){var t=function(r){return function(o,t){for(var n in o="string"==typeof o?{uri:o}:JSON.parse(JSON.stringify(o)),e)void 0===o[n]&&(o[n]=e[n]);return r(o,t)}},n=t(r);return n.get=t(r.get),n.post=t(r.post),n.put=t(r.put),n.head=t(r.head),n},["get","put","post","head"].forEach((function(e){var o=e.toUpperCase();r[e.toLowerCase()]=function(e){"string"==typeof e?e={method:o,uri:e}:(e=JSON.parse(JSON.stringify(e))).method=o;var t=[e].concat(Array.prototype.slice.apply(arguments,[1]));return r.apply(this,t)}})),r.couch=function(e,o){return"string"==typeof e&&(e={uri:e}),e.json=!0,e.body&&(e.json=e.body),delete e.body,o=o||t,r(e,(function(e,r,t){if(e)return o(e,r,t);if((r.statusCode<200||r.statusCode>299)&&t.error){for(var n in e=new Error("CouchDB error: "+(t.error.reason||t.error.error)),t)e[n]=t[n];return o(e,r,t)}return o(e,r,t)}))},r})?t.apply(r,n):t)||(e.exports=a)},,,function(e,r,o){var t=o(1),n=o(0);new t,new n;function a(e){e.stopPropagation(),e.preventDefault();var r=e.target.files||e.dataTransfer.files;!function(e){switch(function(e){var r=e.split(".");return r[r.length-1]}(e).toLowerCase()){case"jpg":case"jpeg":case"gif":case"png":return!0}return!1}(r[0].name)?document.querySelector(".error").innerHTML="Invalid file format. Please try again":(document.querySelector("#add-image").removeEventListener("drop",a,!1),document.querySelector("#add-file").removeEventListener("change",a,!1),document.querySelector("#drag-icon").setAttribute("src","../build/image/loading.png"),console.log(document.querySelector("#drag-icon").getAttribute("src")),browser.runtime.sendMessage({task:"upload",file:r[0]}).then(e=>{if(1==e.success){var r=browser.windows.WINDOW_ID_CURRENT;browser.windows.remove(r)}}))}document.querySelector("#add-image").addEventListener("dragover",(function(e){e.stopPropagation(),e.preventDefault(),this.style.background="grey"}),!1),document.querySelector("#add-image").addEventListener("dragleave",(function(){this.style.background="white"})),document.querySelector("#add-image").addEventListener("drop",(function(e){this.style.background="white"}),!1),document.querySelector("#add-image").addEventListener("drop",a,!1),document.querySelector("#click-image").addEventListener("click",(function(){return document.querySelector("#add-file").click(),!1}),!1),document.querySelector("#add-file").addEventListener("change",a,!1),window.addEventListener("paste",e=>{var r=e.clipboardData.items;for(let e=0;e<r.length;e++)if(-1!=r[e].type.indexOf("image")){console.log("test");var o=r[e].getAsFile(),t=document.createElement("canvas"),n=t.getContext("2d"),a=new Image;a.onload=function(){var e;t.width=this.width,t.height=this.height,n.drawImage(a,0,0),console.log(t.toDataURL()),e=t.toDataURL(),document.querySelector("#drag-icon").setAttribute("src","../build/image/loading.png"),console.log(document.querySelector("#drag-icon").getAttribute("src")),browser.runtime.sendMessage({task:"upload",url:e}).then(e=>{if(1==e.success){var r=browser.windows.WINDOW_ID_CURRENT;browser.windows.remove(r)}})};var i=window.URL||window.webkitURL;a.src=i.createObjectURL(o)}})}]);
//# sourceMappingURL=upload_panel.bundle.js.map